#VRML_SIM R2023b utf8
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/trees/protos/Oak.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/street_furniture/protos/Bench.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/buildings/protos/ResidentialTower.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/roads/protos/Road.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/roads/protos/StraightRoadSegment.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/floors/protos/ParquetryFloor.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/objects/factory/protos/StorageCrate.proto"

WorldInfo {
  coordinateSystem "NUE"
  basicTimeStep 16
}
Viewpoint {
  orientation -0.181 0.683 -0.707 4.0
  position 25 35 25
}
TexturedBackground {
}
TexturedBackgroundLight {
}

# Ground and basic terrain
Ground {
  size 100 100
}
Transform {
  translation 0 0 -0.1
  children [
    Shape {
      appearance PBRAppearance {
        baseColorMap ImageTexture {
          url [
            "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/default/worlds/textures/grass.jpg"
          ]
        }
        roughness 1
        metalness 0
      }
      geometry Plane {
        size 100 100
      }
    }
  ]
}

# Central urban area with buildings
Transform {
  translation 10 10 0
  children [
    ResidentialTower {
      translation 0 0 0
      floorNumber 5
    }
  ]
}

Transform {
  translation -10 15 0
  children [
    ResidentialTower {
      translation 0 0 0
      floorNumber 3
    }
  ]
}

Transform {
  translation 15 -8 0
  children [
    ResidentialTower {
      translation 0 0 0
      floorNumber 4
    }
  ]
}

# Roads network
StraightRoadSegment {
  translation 0 20 0.01
  rotation 0 0 1 1.5708
  numberOfLanes 2
  length 40
}

StraightRoadSegment {
  translation 20 0 0.01
  rotation 0 0 1 0
  numberOfLanes 2
  length 40
}

# Park area with trees and benches
Transform {
  translation -15 -10 0
  children [
    ParquetryFloor {
      tileSize 2.5
      numberOfTiles 8 6
    }
  ]
}

# Tree obstacles
Oak {
  translation -12 -8 0
  size 1.5
}

Oak {
  translation -18 -8 0
  size 1.2
}

Oak {
  translation -15 -5 0
  size 1.3
}

Oak {
  translation -15 -12 0
  size 1.4
}

# Park benches
Bench {
  translation -10 -10 0
  rotation 0 0 1 0.78
}

Bench {
  translation -20 -10 0
  rotation 0 0 1 -0.78
}

# Industrial area with storage crates
Transform {
  translation 25 25 0
  children [
    StorageCrate {
      translation 0 0 0
    }
  ]
}

Transform {
  translation 30 25 0
  children [
    StorageCrate {
      translation 0 0 0
    }
  ]
}

Transform {
  translation 25 30 0
  children [
    StorageCrate {
      translation 0 0 2
    }
  ]
}

Transform {
  translation 30 30 0
  children [
    StorageCrate {
      translation 0 0 1.5
    }
  ]
}

# Natural obstacles - forest area
Transform {
  translation -25 -25 0
  children [
    Shape {
      appearance PBRAppearance {
        baseColorMap ImageTexture {
          url [
            "https://raw.githubusercontent.com/cyberbotics/webots/R2023b/projects/default/worlds/textures/forest_floor.jpg"
          ]
        }
      }
      geometry Plane {
        size 30 30
      }
    }
  ]
}

# Dense tree cluster
Oak {
  translation -30 -30 0
  size 1.8
}

Oak {
  translation -25 -30 0
  size 1.6
}

Oak {
  translation -20 -30 0
  size 1.7
}

Oak {
  translation -30 -25 0
  size 1.5
}

Oak {
  translation -20 -25 0
  size 1.9
}

Oak {
  translation -30 -20 0
  size 1.4
}

Oak {
  translation -25 -20 0
  size 1.6
}

Oak {
  translation -20 -20 0
  size 1.7
}

# Water feature (lake)
Transform {
  translation 0 -25 0
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.2 0.4 0.8
        transparency 0.3
        roughness 0.1
      }
      geometry Cylinder {
        height 0.5
        radius 8
      }
    }
  ]
}

# Elevated platform
Transform {
  translation -30 20 2
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.7 0.7 0.7
        roughness 0.8
      }
      geometry Box {
        size 6 6 4
      }
    }
  ]
}

# Narrow passage (gate-like structure)
Transform {
  translation 20 -15 0
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.9 0.7 0.3
      }
      geometry Box {
        size 1 8 6
      }
    }
  ]
}

Transform {
  translation 25 -15 0
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0.9 0.7 0.3
      }
      geometry Box {
        size 1 8 6
      }
    }
  ]
}

# ============================================================================
# DRONES - Enhanced with realistic sensors and capabilities
# ============================================================================

DEF DRONE_1 Robot {
  translation -5 0 1
  rotation 0 0 1 0
  children [
    # Core sensors
    GPS {
      name "gps_1"
    }
    InertialUnit {
      name "imu_1"
    }
    Compass {
      name "compass_1"
    }
    
    # Proximity sensors for obstacle detection
    DistanceSensor {
      translation 0.2 0 0
      rotation 0 0 1 1.5708
      name "front_sensor_1"
      lookupTable [
        0 0 0
        5 500 0
      ]
    }
    DistanceSensor {
      translation -0.2 0 0
      rotation 0 0 1 -1.5708
      name "back_sensor_1"
      lookupTable [
        0 0 0
        5 500 0
      ]
    }
    DistanceSensor {
      translation 0 0.2 0
      rotation 0 0 1 3.1416
      name "right_sensor_1"
      lookupTable [
        0 0 0
        5 500 0
      ]
    }
    DistanceSensor {
      translation 0 -0.2 0
      rotation 0 0 1 0
      name "left_sensor_1"
      lookupTable [
        0 0 0
        5 500 0
      ]
    }
    
    # Communication devices
    Emitter {
      name "emitter_1"
      channel 1
      range 50
    }
    Receiver {
      name "receiver_1"
      channel 1
      range 50
    }
    
    # Camera for visual feedback
    Camera {
      translation 0.1 0 0
      rotation 0 0 1 1.5708
      name "camera_1"
      fieldOfView 1.2
      width 128
      height 128
    }
    
    # Drone body with realistic appearance
    Shape {
      appearance PBRAppearance {
        baseColor 1 0 0
        roughness 0.3
        metalness 0.7
      }
      geometry Cylinder {
        height 0.1
        radius 0.2
      }
    }
    
    # Rotor arms
    Transform {
      translation 0.15 0.15 0
      children [
        Shape {
          appearance PBRAppearance {
            baseColor 0.2 0.2 0.2
          }
          geometry Box {
            size 0.3 0.03 0.02
          }
        }
      ]
    }
    
    Transform {
      translation -0.15 -0.15 0
      children [
        Shape {
          appearance PBRAppearance {
            baseColor 0.2 0.2 0.2
          }
          geometry Box {
            size 0.3 0.03 0.02
          }
        }
      ]
    }
    
    # LED status indicator
    Transform {
      translation 0 0 0.06
      children [
        Shape {
          appearance PBRAppearance {
            baseColor 0 1 0
            emissiveColor 0 0.5 0
          }
          geometry Sphere {
            radius 0.02
          }
        }
      ]
    }
  ]
  name "drone_1"
  controller "drone_controller"
  description "Quadcopter UAV with full sensor suite"
}

DEF DRONE_2 Robot {
  translation 5 0 1
  rotation 0 0 1 0
  children [
    GPS {
      name "gps_2"
    }
    InertialUnit {
      name "imu_2"
    }
    Compass {
      name "compass_2"
    }
    DistanceSensor {
      translation 0.2 0 0
      rotation 0 0 1 1.5708
      name "front_sensor_2"
      lookupTable [
        0 0 0
        5 500 0
      ]
    }
    Emitter {
      name "emitter_2"
      channel 1
      range 50
    }
    Receiver {
      name "receiver_2"
      channel 1
      range 50
    }
    Camera {
      translation 0.1 0 0
      rotation 0 0 1 1.5708
      name "camera_2"
      fieldOfView 1.2
      width 128
      height 128
    }
    Shape {
      appearance PBRAppearance {
        baseColor 0 0 1
        roughness 0.3
        metalness 0.7
      }
      geometry Cylinder {
        height 0.1
        radius 0.2
      }
    }
    Transform {
      translation 0.15 0.15 0
      children [
        Shape {
          appearance PBRAppearance {
            baseColor 0.2 0.2 0.2
          }
          geometry Box {
            size 0.3 0.03 0.02
          }
        }
      ]
    }
    Transform {
      translation 0 0 0.06
      children [
        Shape {
          appearance PBRAppearance {
            baseColor 0 1 0
            emissiveColor 0 0.5 0
          }
          geometry Sphere {
            radius 0.02
          }
        }
      ]
    }
  ]
  name "drone_2"
  controller "drone_controller"
  description "Quadcopter UAV with full sensor suite"
}

# ============================================================================
# MISSION TARGETS - Multiple flag positions for CTF game
# ============================================================================

# Primary flag (red team)
Transform {
  translation 25 -25 1
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 1 0 0
      }
      geometry Cylinder {
        height 2
        radius 0.1
      }
    }
    Transform {
      translation 0 0 1.5
      children [
        Shape {
          appearance PBRAppearance {
            baseColor 1 0 0
          }
          geometry Box {
            size 0.8 0.4 0.1
          }
        }
      ]
    }
  ]
}

# Secondary flag (blue team)  
Transform {
  translation -25 25 1
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0 0 1
      }
      geometry Cylinder {
        height 2
        radius 0.1
      }
    }
    Transform {
      translation 0 0 1.5
      children [
        Shape {
          appearance PBRAppearance {
            baseColor 0 0 1
          }
          geometry Box {
            size 0.8 0.4 0.1
          }
        }
      ]
    }
  ]
}

# Neutral objective
Transform {
  translation 0 25 1
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 0 1 0
      }
      geometry Cylinder {
        height 2
        radius 0.1
      }
    }
    Transform {
      translation 0 0 1.5
      children [
        Shape {
          appearance PBRAppearance {
            baseColor 0 1 0
          }
          geometry Sphere {
            radius 0.3
          }
        }
      ]
    }
  ]
}

# ============================================================================
# MISSION WAYPOINTS - Visual markers for navigation
# ============================================================================

# Waypoint markers
Transform {
  translation 15 15 0.1
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 1 1 0
        transparency 0.7
      }
      geometry Cylinder {
        height 0.05
        radius 1
      }
    }
  ]
}

Transform {
  translation -15 -15 0.1
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 1 1 0
        transparency 0.7
      }
      geometry Cylinder {
        height 0.05
        radius 1
      }
    }
  ]
}

Transform {
  translation 0 -10 0.1
  children [
    Shape {
      appearance PBRAppearance {
        baseColor 1 1 0
        transparency 0.7
      }
      geometry Cylinder {
        height 0.05
        radius 1
      }
    }
  ]
}